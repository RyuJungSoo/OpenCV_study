**영상 처리**는 밝기 또는 색상 분포와 같은 영상의 특성을 알아내고, 이를 목적에 맞도록 처리한다는 **좁은 의미**와 
영상 데이터를 인위적으로 조작하는 어떠한 연산이라는 **넓은 의미**를 모두 포함하고 있다.

# 1.1 이진 및 그레이 영상
**영상**은 한 픽셀을 표현하기 위해 몇 단계의 레벨과 채널을 구성되는지에 딸서 종류를 구분한다.        
**레벨**은 픽셀이 가질 수 있는 값의 범위(0~255)를 의미하고, **채널**은 픽셀이 몇 개의 값으로 구성되는지를 의미한다. (ex. RGB -> 채널 수: 3)         
***
## 이진 영상
![images_redorangeyellowy_post_1850b51a-672c-4a9b-b381-da268353eada_image](https://user-images.githubusercontent.com/81175672/177175364-960aea12-4fc0-47c4-b4a4-135cf893eb66.png)                     
**이진 영상**은 검정과 흰색의 2가지 레벨로 표현되고, 채널의 수는 1개이다. 정보를 2가지 레벨로 분류하여 표현하더라도 손실이 없는 것들이 이진 영상으로 
표현하기에 적합한 대상이다. (ex. 활자로 이루어진 문서)      

## 이진화
영상을 검정과 흰색으로 변환하는 것을 **이진화**(Binarization)라고 하며 아래의 수식으로 표현할 수 있다.
![캡처1](https://user-images.githubusercontent.com/81175672/177177819-2a09cc4c-cf9b-495c-b04a-5211dd730ec0.JPG)             
org와 res는 각각 입력 영상과 출력 영상을 의미하고, (i,j)는 픽셀 위치를 나타낸다.       
만약 입력 영상의 픽셀이 정해진 임계치 T보다 **크다면** 출력 영상에 대응하는 위치의 픽셀은 **흰색**(255)이 되고, **반대의 경우**에는 **검정**(0)이 된다.         
설정한 임계치에 따라서 영상이 다양하게 표현되기 때문에 목적에 맞도록 적절한 임계치를 설정해야 한다.      
***

## 그레이 영상
![p023](https://user-images.githubusercontent.com/81175672/177180152-c698edf3-3fa1-443e-b69b-7eedcb269ae5.jpg)              
그레이 영상은 1개의 채널과 256단계의 레벨로 구성된다. 좀 더 정확하게는 1개의 채널을 통하여 **명암**만을 표현할 수 있는 것이 **그레이 영상**이며 명암의 단계는 다양하게 정의할 수 있다.          
컴퓨터 프로그래밍을 통하여 영상 처리를 수행할 때 하나의 픽셀을 8비트로 처리하던 관습으로, 대부분의 경우에 명암 단계를 8비트로 표현할 수 있는 [0, 255] 범위로 가정한다.         
***
## threshold() 함수
OpenCV에서는 **threshold() 함수**를 이용하여 영상 이진화를 수행할 수 있으며, 이 함수의 원형은 아래와 같다.          
***
**threshold(src, thresh, maxcal, type, dst=None)**           
연산: 입력 영상을 지정된 임계치(thresh)와 방법(type)을 이용하여 이진화한다.     
| 매개변수 | 의미 |
| --- | --- |
| src | 입력 행렬 (다중 채널, 8비트 또는 32비트의 실수) |
| thresh | 임계치 |
| maxval | 특정 방법 (THRESH_BINARY, THRESH_BINARY_INV)을 사용할 때에 반환값의 최댓값 |
| type | 이진화 방법 (THRESH_BINARY, THRESH_BINARY_INV, THRESH_TRUNC, THRESH_TOZERO, THRESH_TOZERO_INV, THRESH_MASK, THRESH_OTSU, THRESH_TRIANGLE) |
| dst | 결과 행렬 (입력 행렬과 동일한 크기와 채널의 수를 가짐) |
***
이진화를 수행하는 방법은 아래 표와 같다.
| ThresholdTypes 열거형 상수 | 설명 |
| --- | --- |
| THRESH_BINARY | 일반적인 이진화 방식으로, 픽셀값이 thresh를 넘으면 최대값, 아니면 0입니다. |
| THRESH_BINARY_INV | THRESH_BINARY의 inverse입니다. thresh를 넘으면 0, 아니면 최대값입니다. |
| THRESH_TRUNC | 픽셀값이 thresh를 넘으면 thresh값으로, 아니라면 그대로 둡니다. |
| THRESH_TOZERO | 픽셀값이 thresh를 넘으면 원본값으로 놔두고 아니면 0입니다. |
| THRESH_TOZERO_INV | THRESH_TOZERO의 inverse, 픽셀값이 thresh를 넘으면 0, 아니면 원본값으로 놔둡니다.|
| THRESH_OTSU | 오츠 알고리즘을 이용한 자동 임계값 설정입니다. |
| THRESH_TRIANGLE | 삼각 알고리즘을 이용한 자동 임계값 설정입니다. |    
***
[threshold()에 대해서](https://bkshin.tistory.com/entry/OpenCV-8-%EC%8A%A4%EB%A0%88%EC%8B%9C%ED%99%80%EB%94%A9Thresholding)                                 
[Otsu 알고리즘에 대해서 1](https://bskyvision.com/49)                               
[Otsu 알고리즘에 대해서 2](https://cafepurple.tistory.com/62)                                   
***
## adaptiveThreshold() 함수
threshold() 함수는 **하나의 임계치**를 이용하여 이진화를 수행하기 때문에 조명 등의 영향으로 입력 영상에 명암이 다양하게 분포할 경우에는 객체와 배경을 명확히 구분하기 어려운 결과 영상을 얻게 된다. (ex. 흰색이 활자이고 검은색이 배경인 경우)        
이를 극복하기 위해서는 **각 픽셀이 적절한 임계치**를 기반으로 이진화가 수행되어야 한다. 이를 위하여 픽셀 주변에 분포하는 값들의 평균을 이용하여 임계치를 구하는 방법이 있으며 
아래 식과 같다.        
![캡처2](https://user-images.githubusercontent.com/81175672/177232723-d9c3e541-a0ec-4fce-b358-35b7ceac5c0b.JPG)          
h'과 w'은 평균값을 구하기 위하여 사용하는 주변 픽셀의 개수(블록의 크기)이고, α는 가중치, C는 계산된 평균값을 조정하기 위한 상수이다.       
OpenCV에서는 이를 위한 함수로 **adaptiveThreshold() 함수**를 지원하며, 원형은 아래와 같다.
***
**adaptiveThreshold(src, maxval, adaptiveMethod, thresholdType, blockSize, C, dst=None)**           
연산: 입력 영상을 지정된 임계치(thresh)와 방법(type)을 이용하여 이진화한다.        
| 매개변수 | 의미 |
| --- | --- |
| src | 입력 행렬 (8비트 단일 채널) |
| maxval | 이진화의 최댓값 (>0) |
| adaptiveMethod | 임계치를 계산하기 위한 방법 (ADAPTIVE_THRESH_MEAN_C, ADAPTIVE_THRESH_GAUSSIAN_C) |
| thresholdType | 이진화 방법 (THRESH_BINARY, THRESH_BINARY_INV) |
| blockSize | 임계치를 계산하기 위하여 사용하는 블록 크기 (3 이상의 홀수 사용) |
| C | 임계치를 조정하기 위한 상수 (평균이나 가중 평균에 C를 반영하여 임계치로 사용) |
| dst | 결과 행렬 (입력 행렬과 동일한 크기와 채널의 수를 가짐) |
***
adaptiveMethod가 **ADAPTIVE_THRESH_MEAN_C**인 경우에는 α가 1이 되어 산술평균을 구하게 된다. 반면에 **ADAPTIVE_THRESH_GAUSSIAN_C**인 경우에는 α가 
가우시안 분포를 따르는 가변적인 값을 가지게 되며, 블록의 중심 픽셀의 값이 큰 비중을 차지하는 가중 평균을 구하게 된다.      
[adaptive Threshold에 대해서](https://hoony-gunputer.tistory.com/entry/OpenCV-python-adaptive-Threshold)       
***
## 예제
```py
import numpy as np
import os
import cv2
from imgRead import imgRead # 따로 파일이 있음
from createFolder import createFolder # 따로 파일이 있음

# 영상 읽기
img1 = imgRead("img14.jpg", cv2.IMREAD_GRAYSCALE, 320, 240)
# 영상 이진화 수행
methods = [cv2.THRESH_BINARY,
           cv2.THRESH_BINARY_INV,
           cv2.THRESH_TRUNC,
           cv2.THRESH_TOZERO,
           cv2.THRESH_TOZERO_INV,
           cv2.THRESH_OTSU,
           cv2.THRESH_TRIANGLE,
           cv2.ADAPTIVE_THRESH_MEAN_C,
           cv2.ADAPTIVE_THRESH_GAUSSIAN_C]

thres = 70; maxVal = 255
ress = []

# threshold
for i in range(0,7):
    ret, res = cv2.threshold(img1, thres, maxVal, methods[i])
    ress.append(res)

# adaptiveThreshold
ress.append(cv2.adaptiveThreshold(img1, maxVal, methods[7], methods[0], 61, 0))
ress.append(cv2.adaptiveThreshold(img1, maxVal, methods[8], methods[0], 61, 0))


# 결과 영상 출력
displays = [("input1", img1), ("res1", ress[0]), ("res2", ress[1]), ("res3", ress[2]),
            ("res4", ress[3]), ("res5", ress[4]), ("res6", ress[5]), ("res7", ress[6]),
            ("res8", ress[7]), ("res9", ress[8])]

for (name, out) in displays:
    cv2.imshow(name, out)

# 키보드 입력을 기다린 후 모든 영상창 닫기
cv2.waitKey(0)
cv2.destroyAllWindows()

# 영상 저장
save_dir = './code_res_imgs/c2_threshold'
createFolder('./code_res_imgs/c2_threshold')
for (name, out) in displays:
    cv2.imwrite(save_dir+"/"+name+".jpg",out)

```
***
## 출력 결과
<입력 영상>            
<img src="https://user-images.githubusercontent.com/81175672/177302783-4af0c83b-4202-476b-bb13-dbb12319161e.jpg"  width="300" height="300"/>               
<입력 영상에 대하여 픽셀값 70을 임계치로 사용하였을 경우에 대한 cv2.THRESH_BINARY 결과>                  
<img src="https://user-images.githubusercontent.com/81175672/177306636-3819517f-f1bb-4eb9-b85d-71a62474b775.jpg"  width="300" height="300"/>                     
<입력 영상에 대하여 픽셀값 70을 임계치로 사용하였을 경우에 대한 cv2.THRESH_BINARY_INV 결과>                   
<img src="https://user-images.githubusercontent.com/81175672/177306801-57e5dfb9-d2b5-4e0c-a1b1-571494a9306c.jpg"  width="300" height="300"/>                     
<입력 영상에 대하여 픽셀값 70을 임계치로 사용하였을 경우에 대한 cv2.THRESH_TRUNC 결과>                  
<img src="https://user-images.githubusercontent.com/81175672/177307359-1245e88c-b228-4927-80d2-9f4b9073cce8.jpg"  width="300" height="300"/>                  
<입력 영상에 대하여 픽셀값 70을 임계치로 사용하였을 경우에 대한 cv2.THRESH_TOZERO 결과>                  
<img src="https://user-images.githubusercontent.com/81175672/177308323-2f2f48a5-3f30-4177-b22c-30e421c1e931.jpg"  width="300" height="300"/>     
<입력 영상에 대하여 픽셀값 70을 임계치로 사용하였을 경우에 대한 cv2.THRESH_TOZERO_INV 결과>                  
<img src="https://user-images.githubusercontent.com/81175672/177309018-5954816c-01d7-4832-aa5f-b918e657ad3b.jpg"  width="300" height="300"/>           
<입력 영상에 대하여 픽셀값 70을 임계치로 사용하였을 경우에 대한 cv2.THRESH_OTSU 결과>            
<img src="https://user-images.githubusercontent.com/81175672/177309218-50df7326-1eef-4703-aba6-1c2b4181604c.jpg"  width="300" height="300"/>                 
<입력 영상에 대하여 픽셀값 70을 임계치로 사용하였을 경우에 대한 cv2.THRESH_TRIANGLE 결과>              
<img src="https://user-images.githubusercontent.com/81175672/177309320-24a76490-7d38-4e3b-8149-3276356b3cef.jpg"  width="300" height="300"/>              
<ADAPTIVE_THRESH_MEAN_C 결과>                    
<img src="https://user-images.githubusercontent.com/81175672/177309629-a759b842-6cc3-4a7e-9a58-1fa31f2dda38.jpg"  width="300" height="300"/>  
<ADAPTIVE_THRESH_GAUSSIAN_C 결과>              
<img src="https://user-images.githubusercontent.com/81175672/177309680-53d19751-6c34-4faf-a706-687b10a5ae4b.jpg"  width="300" height="300"/>  
